
<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Curve Parser</title>

    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://d3js.org/d3.v3.min.js"></script>


    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body>
    <div class="wrapper">
        <header>
            <h1>Curve Parser</h1>
        </header>
        <section id="main-content">
            <h3>
            <button onclick="send()" id="message_button">send message</button>
            <p>Message:</p>
            <div id="results"></div>
            <br/>

            <script>

                var iframeSource = 'curveParser.html';
                var parser = document.createElement('iframe');
                parser.setAttribute('src', iframeSource);
                parser.setAttribute('id', 'cParser');
                parser.style.width = 2000 + 'px';
                parser.style.height = 1000 +'px';
                document.getElementById('main-content').appendChild(parser);
                
                let fromServer = {
                    // lofunc is used to determine number of ticks on x axis.
                    "lofunc": [
                        0,
                        0,
                        0,
                        0,
                        0,
                        0,
                        0,
                        0,
                        0,
                        0
                    ],    
                    "minValue": 0,
                    "maxValue": 100,
                    "title": "Independent Variable vs. Dependent Variable",
                    "xlabel": "Independent Variable (Units)",
                    "ylabel": "Dependent Variable (Units)",
                    "xVals": [
                        "260 - 265",
                        "265 - 270",
                        "270 - 275",
                        "275 - 280",
                        "280 - 285",
                        "285 - 290",
                        "290 - 295",
                        "295 - 300",
                        "300 - 305",
                        "305 - 310"
                    ],
                    "rotateTicks": true
                }

                $("#cParser").load(function () {
                    setupIframe(fromServer);
                });

                function setupIframe(fromServer)
                {
                    var parser = document.getElementById('cParser');
                    function bindEvent(element, eventName, eventHandler) 
                    {
                        if (element.addEventListener)
                        {
                            element.addEventListener(eventName, eventHandler, false);
                        } else if (element.attachEvent) {
                            element.attachEvent('on' + eventName, eventHandler);
                        }
                    }

                    // Listen to message from child window
                    bindEvent(window, 'message', function (e) {

                        console.log("message from child: " + e.data);

                        if(e.data == "ready")
                        {
                            console.log("Child is ready");
                            let args = JSON.stringify(fromServer);
                            parser.contentWindow.postMessage(args, '*');  
                            return;
                        }
                        else if(e.data == "hitPart2")
                        {
                            //$('#secondCInstructions').hide();
                            //$('#thirdCInstructions').show();
                            //incrementCounter();

                            console.log("hit part 2 from parent");
                            return;
                        }
                        else if(e.data == "returnedToPart1")
                        {
                            //$('#thirdCInstructions').hide();
                            //$('#secondCInstructions').show();
                            
                            //decrementCounter();

                            console.log("returned to part 1 from parent");
                            return;
                        }
                        
                        
                        //let normalizedCoords = normCoords(JSON.parse(e.data));
                        //results.innerHTML = normalizedCoords;
                        // drawnLine is a global from js/onReady.js
                        //drawnLine = normalizedCoords;
                        // trigger User's progression to next view
                        //$("#stepDad").attr("style", "display: none");
                        // $("#outer-container").attr("style", "display: inline");
                        //$("#curveIntro").hide(); // hide curveIntro's Next button.
                        //incrementCounter();
                        //$("#quiz-keypoints").show();
                    });
                }

            </script>

        </section>
    </div>

</body>
</html>
